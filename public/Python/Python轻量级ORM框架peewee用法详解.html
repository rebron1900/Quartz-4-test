<!DOCTYPE html>
<html><head><title>Python轻量级ORM框架peewee用法详解</title><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta property="og:title" content="Python轻量级ORM框架peewee用法详解"/><meta property="og:description" content="本文中代码样例所使用的 Person 模型如下： class Person(Model): Name = CharField() Age = IntegerField() Birthday = DateTimeField() Remarks = CharField(null=True) 一、新增 § 1、create § Model."/><meta property="og:image" content="https://four.quartz.jzhao.xyz/static/og-image.png"/><meta property="og:width" content="1200"/><meta property="og:height" content="675"/><link rel="icon" href="../../static/icon.png"/><meta name="description" content="本文中代码样例所使用的 Person 模型如下： class Person(Model): Name = CharField() Age = IntegerField() Birthday = DateTimeField() Remarks = CharField(null=True) 一、新增 § 1、create § Model."/><meta name="generator" content="Quartz"/><link rel="preconnect" href="https://fonts.googleapis.com"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link href="../../index.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/><link href="https://fonts.googleapis.com/css2?family=IBM Plex Mono&amp;family=Schibsted Grotesk:wght@400;700&amp;family=Source Sans Pro:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap" rel="stylesheet" type="text/css" spa-preserve/><script src="../../prescript.js" type="application/javascript" spa-preserve></script><script type="application/javascript" spa-preserve>const fetchData = fetch(`../../static/contentIndex.json`).then(data => data.json())</script></head><body data-slug="Python/Python轻量级ORM框架peewee用法详解"><div id="quartz-root" class="page"><div id="quartz-body"><div class="left sidebar"><h1 class="page-title"><a href="../..">🪴 Quartz 4.0</a></h1><div class="spacer mobile-only"></div><div class="search"><div id="search-icon"><p>Search</p><div></div><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search</title><desc id="desc">Search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path><circle cx="8" cy="8" r="7"></circle></g></svg></div><div id="search-container"><div id="search-space"><input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Search for something" placeholder="Search for something"/><div id="results-container"></div></div></div></div><div class="darkmode"><input class="toggle" id="darkmode-toggle" type="checkbox" tabindex="-1"/><label id="toggle-label-light" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="dayIcon" x="0px" y="0px" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35;" xml:space="preserve"><title>Light mode</title><path d="M6,17.5C6,16.672,5.328,16,4.5,16h-3C0.672,16,0,16.672,0,17.5    S0.672,19,1.5,19h3C5.328,19,6,18.328,6,17.5z M7.5,26c-0.414,0-0.789,0.168-1.061,0.439l-2,2C4.168,28.711,4,29.086,4,29.5    C4,30.328,4.671,31,5.5,31c0.414,0,0.789-0.168,1.06-0.44l2-2C8.832,28.289,9,27.914,9,27.5C9,26.672,8.329,26,7.5,26z M17.5,6    C18.329,6,19,5.328,19,4.5v-3C19,0.672,18.329,0,17.5,0S16,0.672,16,1.5v3C16,5.328,16.671,6,17.5,6z M27.5,9    c0.414,0,0.789-0.168,1.06-0.439l2-2C30.832,6.289,31,5.914,31,5.5C31,4.672,30.329,4,29.5,4c-0.414,0-0.789,0.168-1.061,0.44    l-2,2C26.168,6.711,26,7.086,26,7.5C26,8.328,26.671,9,27.5,9z M6.439,8.561C6.711,8.832,7.086,9,7.5,9C8.328,9,9,8.328,9,7.5    c0-0.414-0.168-0.789-0.439-1.061l-2-2C6.289,4.168,5.914,4,5.5,4C4.672,4,4,4.672,4,5.5c0,0.414,0.168,0.789,0.439,1.06    L6.439,8.561z M33.5,16h-3c-0.828,0-1.5,0.672-1.5,1.5s0.672,1.5,1.5,1.5h3c0.828,0,1.5-0.672,1.5-1.5S34.328,16,33.5,16z     M28.561,26.439C28.289,26.168,27.914,26,27.5,26c-0.828,0-1.5,0.672-1.5,1.5c0,0.414,0.168,0.789,0.439,1.06l2,2    C28.711,30.832,29.086,31,29.5,31c0.828,0,1.5-0.672,1.5-1.5c0-0.414-0.168-0.789-0.439-1.061L28.561,26.439z M17.5,29    c-0.829,0-1.5,0.672-1.5,1.5v3c0,0.828,0.671,1.5,1.5,1.5s1.5-0.672,1.5-1.5v-3C19,29.672,18.329,29,17.5,29z M17.5,7    C11.71,7,7,11.71,7,17.5S11.71,28,17.5,28S28,23.29,28,17.5S23.29,7,17.5,7z M17.5,25c-4.136,0-7.5-3.364-7.5-7.5    c0-4.136,3.364-7.5,7.5-7.5c4.136,0,7.5,3.364,7.5,7.5C25,21.636,21.636,25,17.5,25z"></path></svg></label><label id="toggle-label-dark" for="darkmode-toggle" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="nightIcon" x="0px" y="0px" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'" xml:space="preserve"><title>Dark mode</title><path d="M96.76,66.458c-0.853-0.852-2.15-1.064-3.23-0.534c-6.063,2.991-12.858,4.571-19.655,4.571  C62.022,70.495,50.88,65.88,42.5,57.5C29.043,44.043,25.658,23.536,34.076,6.47c0.532-1.08,0.318-2.379-0.534-3.23  c-0.851-0.852-2.15-1.064-3.23-0.534c-4.918,2.427-9.375,5.619-13.246,9.491c-9.447,9.447-14.65,22.008-14.65,35.369  c0,13.36,5.203,25.921,14.65,35.368s22.008,14.65,35.368,14.65c13.361,0,25.921-5.203,35.369-14.65  c3.872-3.871,7.064-8.328,9.491-13.246C97.826,68.608,97.611,67.309,96.76,66.458z"></path></svg></label></div><div class="desktop-only"><button type="button" id="toc"><h3>Table of Contents</h3><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="fold"><polyline points="6 9 12 15 18 9"></polyline></svg></button><div id="toc-content"><ul class="overflow"><li class="depth-0"><a href="#一新增" data-for="一新增">一、新增</a></li><li class="depth-0"><a href="#二删除" data-for="二删除">二、删除</a></li><li class="depth-0"><a href="#三修改" data-for="三修改">三、修改</a></li><li class="depth-0"><a href="#四查询" data-for="四查询">四、查询</a></li><li class="depth-0"><a href="#五查询条件" data-for="五查询条件">五、查询条件</a></li><li class="depth-0"><a href="#六支持的比较符" data-for="六支持的比较符">六、支持的比较符</a></li></ul></div></div></div><div class="center"><div class="page-header"><div class="popover-hint"><h1 class="article-title">Python轻量级ORM框架peewee用法详解</h1><p class="content-meta">Aug 08, 2023, 15 min read</p><ul class="tags"><li><a href="../../tags/python" class="internal tag-link">#python</a></li></ul></div></div><article class="popover-hint"><p>本文中代码样例所使用的 <em>Person</em> 模型如下：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">class</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">Person</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-function);">Model</span><span style="color:var(--shiki-color-text);">):    </span><span style="color:var(--shiki-token-function);">Name</span><span style="color:var(--shiki-color-text);"> = </span><span style="color:var(--shiki-token-function);">CharField</span><span style="color:var(--shiki-color-text);">()    </span><span style="color:var(--shiki-token-function);">Age</span><span style="color:var(--shiki-color-text);"> = </span><span style="color:var(--shiki-token-function);">IntegerField</span><span style="color:var(--shiki-color-text);">()    </span><span style="color:var(--shiki-token-function);">Birthday</span><span style="color:var(--shiki-color-text);"> = </span><span style="color:var(--shiki-token-function);">DateTimeField</span><span style="color:var(--shiki-color-text);">()    </span><span style="color:var(--shiki-token-function);">Remarks</span><span style="color:var(--shiki-color-text);"> = </span><span style="color:var(--shiki-token-function);">CharField</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-function);">null</span><span style="color:var(--shiki-color-text);">=</span><span style="color:var(--shiki-token-function);">True</span><span style="color:var(--shiki-color-text);">)</span></span></code></pre></div>
<h3 id="一新增"><strong>一、新增</strong><a aria-hidden="true" tabindex="-1" href="#一新增" class="internal"> §</a></h3>
<h4 id="1create"><strong>1、create</strong><a aria-hidden="true" tabindex="-1" href="#1create" class="internal"> §</a></h4>
<p><code>Model.create</code> 向<a href="https://cloud.tencent.com/solution/database?from=10680" class="external">数据库</a>中插入一条记录，并返回一个新的实例。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">p </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.create</span><span style="color:var(--shiki-color-text);">(Name</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">'张三'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Age</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">30</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Birthday</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1990</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">))</span></span></code></pre></div>
<h4 id="2save"><strong>2、save</strong><a aria-hidden="true" tabindex="-1" href="#2save" class="internal"> §</a></h4>
<p><strong>语法：</strong></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-function);">save</span><span style="color:var(--shiki-color-text);">(force_insert</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">False</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> only</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">None)</span></span></code></pre></div>
<p><strong>参数：</strong></p>
<ul>
<li>force_insert：是否强制插入</li>
<li>only(list)：需要持久化的字段，当提供此参数时，只有提供的字段被持久化。</li>
</ul>
<p><strong>示例：</strong></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">p1 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">Person</span><span style="color:var(--shiki-color-text);">(Name</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">'王五'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Age</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">50</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Birthday</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1970</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">))</span><span style="color:var(--shiki-token-constant);">p1</span><span style="color:var(--shiki-token-function);">.save</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<p>这里说的比较简单，下面会详细说明。</p>
<h4 id="3insert"><strong>3、insert</strong><a aria-hidden="true" tabindex="-1" href="#3insert" class="internal"> §</a></h4>
<p><code>insert</code> 只插入数据而不创建模型实例，返回新行的主键。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.insert</span><span style="color:var(--shiki-color-text);">(Name</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">'李四'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Age</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">40</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Birthday</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1980</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">))</span><span style="color:var(--shiki-token-function);">.execute</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<h4 id="4insert_many"><strong>4、insert_many</strong><a aria-hidden="true" tabindex="-1" href="#4insert_many" class="internal"> §</a></h4>
<p><strong>语法：</strong></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-function);">insert_many</span><span style="color:var(--shiki-color-text);">(rows</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> fields</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">None)</span></span></code></pre></div>
<p><strong>参数：</strong></p>
<ul>
<li>rows：元组或字典列表，要插入的数据</li>
<li>fields(list)：需要插入的字段名列表。</li>
</ul>
<blockquote>
<p>说明： 1、当 rows 传递的是字典列表时，fields 是不需要传的，如果传了，那么，rows 中的字段在字典中必须存在，否则报错。如果没有传递 fields 参数，那么默认取所有字典的交集作为插入字段。这个也好理解，比如一个字典的键是</p>
</blockquote>
<p><strong>示例：</strong></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.insert_many</span><span style="color:var(--shiki-color-text);">([    (</span><span style="color:var(--shiki-token-string-expression);">'张三'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">30</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1990</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">))</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">    (</span><span style="color:var(--shiki-token-string-expression);">'李四'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">40</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1980</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">))</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">    (</span><span style="color:var(--shiki-token-string-expression);">'王五'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">50</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1970</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">))]</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">    [</span><span style="color:var(--shiki-token-string-expression);">'Name'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Age'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Birthday'</span><span style="color:var(--shiki-color-text);">])</span><span style="color:var(--shiki-token-function);">.execute</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.insert_many</span><span style="color:var(--shiki-color-text);">([    {</span><span style="color:var(--shiki-token-string-expression);">'Name'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'张三'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Age'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">30</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Birthday'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1990</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)}</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">    {</span><span style="color:var(--shiki-token-string-expression);">'Name'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'李四'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Age'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">40</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Birthday'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1980</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)}</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">    {</span><span style="color:var(--shiki-token-string-expression);">'Name'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'王五'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Age'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">50</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Birthday'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1970</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)}])</span><span style="color:var(--shiki-token-function);">.execute</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<p>对于批量操作，应该放在事务中执行：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">with</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">db</span><span style="color:var(--shiki-token-function);">.atomic</span><span style="color:var(--shiki-color-text);">():    </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.insert_many</span><span style="color:var(--shiki-color-text);">(data</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> fields</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">fields)</span><span style="color:var(--shiki-token-function);">.execute</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<blockquote>
<p>在使用批量插入时，如果是 SQLite，SQLite3 版本必须为 3.7.11.0 或更高版本才能利用批量插入API。此外，默认情况下，SQLite 将 SQL 查询中的绑定变量数限制为 999。</p>
</blockquote>
<p>SQLite 中，当批量插入的行数超过 999 时，就需要使用循环来将数据批量分组：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">with</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">db</span><span style="color:var(--shiki-token-function);">.atomic</span><span style="color:var(--shiki-color-text);">():    for idx </span><span style="color:var(--shiki-token-keyword);">in</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">range</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">len</span><span style="color:var(--shiki-color-text);">(data)</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">100</span><span style="color:var(--shiki-color-text);">):        </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.insert_many</span><span style="color:var(--shiki-color-text);">(data[idx: idx</span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-token-constant);">100</span><span style="color:var(--shiki-color-text);">]</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> fields</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">fields)</span><span style="color:var(--shiki-token-function);">.execute</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<p><em>Peewee</em> 中带有一个分块辅助函数 <code>chunked()</code>，使用它可以有效地将通用迭代块分块为一系列批量迭代的迭代：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">from peewee </span><span style="color:var(--shiki-token-keyword);">import</span><span style="color:var(--shiki-color-text);"> chunked# 一次插入 100 行.with db.atomic():    for batch in chunked(data</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> 100):        Person.insert_many(batch).execute()</span></span></code></pre></div>
<h4 id="5bulk_create"><strong>5、bulk_create</strong><a aria-hidden="true" tabindex="-1" href="#5bulk_create" class="internal"> §</a></h4>
<p><strong>语法：</strong></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-function);">bulk_create</span><span style="color:var(--shiki-color-text);">(model_list</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> batch_size</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">None)</span></span></code></pre></div>
<p><strong>参数：</strong></p>
<ul>
<li>model_list (iterable)：未保存的模型实例的列表或其他可迭代对象。</li>
<li>batch_size (int)：每次批量插入的行数。如果未指定，则一次性全部插入。</li>
</ul>
<p><strong>示例：</strong> 简单来说，<code>insert_many</code> 使用字典或元组列表作为参数，而 <code>model_list</code> 使用模型实例列表作为参数，就这区别。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">data </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-function);">Person</span><span style="color:var(--shiki-color-text);">(Name</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">'张三~'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Age</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">30</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Birthday</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1990</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">))</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">        </span><span style="color:var(--shiki-token-function);">Person</span><span style="color:var(--shiki-color-text);">(Name</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">'李四~'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Age</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">40</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Birthday</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1980</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">))]</span><span style="color:var(--shiki-token-keyword);">with</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">db</span><span style="color:var(--shiki-token-function);">.atomic</span><span style="color:var(--shiki-color-text);">():    </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.bulk_create</span><span style="color:var(--shiki-color-text);">(data)</span></span></code></pre></div>
<blockquote>
<p>**注意：**如果使用的是 Postgresql（支持该RETURNING子句），则先前未保存的模型实例将自动填充其新的主键值。</p>
</blockquote>
<p>例如用的是 SQLite，执行上述代码之后，<code>print(data[0].id)</code> 显示的结果是 <code>None</code>。</p>
<h4 id="6batch_commit"><strong>6、batch_commit</strong><a aria-hidden="true" tabindex="-1" href="#6batch_commit" class="internal"> §</a></h4>
<p>这不是一个好的方法，来看下面的例子</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">data_dict </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> [{</span><span style="color:var(--shiki-token-string-expression);">'Name'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'张三'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Age'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">30</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Birthday'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1990</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)}</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">             {</span><span style="color:var(--shiki-token-string-expression);">'Name'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'李四'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Age'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">40</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Birthday'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1980</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)}</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);">             {</span><span style="color:var(--shiki-token-string-expression);">'Name'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'王五'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Age'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">50</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Birthday'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1970</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)}]for row </span><span style="color:var(--shiki-token-keyword);">in</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">db</span><span style="color:var(--shiki-token-function);">.batch_commit</span><span style="color:var(--shiki-color-text);">(data_dict</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">100</span><span style="color:var(--shiki-color-text);">):    p </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.create</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">**</span><span style="color:var(--shiki-color-text);">row)</span></span></code></pre></div>
<p>查看 SQL 语句如下：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'BEGIN'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> None)(</span><span style="color:var(--shiki-token-string-expression);">'INSERT INTO &quot;person&quot; (&quot;Name&quot;, &quot;Age&quot;, &quot;Birthday&quot;) VALUES (?, ?, ?)'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-string-expression);">'张三'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">30</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">datetime</span><span style="color:var(--shiki-token-function);">.date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1990</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)])(</span><span style="color:var(--shiki-token-string-expression);">'INSERT INTO &quot;person&quot; (&quot;Name&quot;, &quot;Age&quot;, &quot;Birthday&quot;) VALUES (?, ?, ?)'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-string-expression);">'李四'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">40</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">datetime</span><span style="color:var(--shiki-token-function);">.date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1980</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)])(</span><span style="color:var(--shiki-token-string-expression);">'INSERT INTO &quot;person&quot; (&quot;Name&quot;, &quot;Age&quot;, &quot;Birthday&quot;) VALUES (?, ?, ?)'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-string-expression);">'王五'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">50</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">datetime</span><span style="color:var(--shiki-token-function);">.date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1970</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)])</span></span></code></pre></div>
<p>其实，<code>batch_commit</code> 就是自动添加了一个事务，然后一条条的插入，所以返回的模型实例中能获取到主键。 参数第一个是字典列表，第二个就是每多少条启用一个事务，大家可以把它改成 1 看下 SQL 语句就明白了。</p>
<h4 id="7insert_from"><strong>7、insert_from</strong><a aria-hidden="true" tabindex="-1" href="#7insert_from" class="internal"> §</a></h4>
<p>使用 <em>SELECT</em> 查询作为源 <em>INSERT</em> 数据。此 API 应用于 <em>INSERT INTO … SELECT FROM …</em> 形式的查询。</p>
<p><strong>语法：</strong></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-function);">insert_from</span><span style="color:var(--shiki-color-text);">(query</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> fields)</span></span></code></pre></div>
<p><strong>参数：</strong></p>
<ul>
<li>query：SELECT查询用作数据源</li>
<li>fields：要将数据插入的字段，此参数必须要的 **示例：**我们将 Person 表按原结构复制一个 Person2 表出来，以做演示。</li>
</ul>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">data </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.select</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Name</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Age</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Birthday)</span><span style="color:var(--shiki-token-constant);">Person2</span><span style="color:var(--shiki-token-function);">.insert_from</span><span style="color:var(--shiki-color-text);">(data</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-string-expression);">'Name'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Age'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Birthday'</span><span style="color:var(--shiki-color-text);">])</span><span style="color:var(--shiki-token-function);">.execute</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<blockquote>
<p><strong>注意：</strong> 因为是 <em>INSERT INTO … SELECT FROM …</em> 形式的，所以数据源的列跟要插入的列必须保持一致。</p>
</blockquote>
<h3 id="二删除"><strong>二、删除</strong><a aria-hidden="true" tabindex="-1" href="#二删除" class="internal"> §</a></h3>
<h4 id="1delete"><strong>1、delete</strong><a aria-hidden="true" tabindex="-1" href="#1delete" class="internal"> §</a></h4>
<p><code>delete</code> 后加 <code>where</code> 删除指定记录，如果不加 <code>where</code>，则删除全部记录。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.delete</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-function);">.where</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Name</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-string-expression);">'王五'</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-function);">.execute</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<h4 id="2delete_instance"><strong>2、delete_instance</strong><a aria-hidden="true" tabindex="-1" href="#2delete_instance" class="internal"> §</a></h4>
<p>删除给定的实例。 <strong>语法：</strong></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-function);">delete_instance</span><span style="color:var(--shiki-color-text);">(recursive</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">False</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> delete_nullable</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">False)</span></span></code></pre></div>
<p><strong>示例：</strong></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">p </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.get</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Name</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-string-expression);">'张三'</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-constant);">p</span><span style="color:var(--shiki-token-function);">.delete_instance</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<p><code>delete_instance</code> 直接执行删除了，不用调用<code>execute()</code> 方法。</p>
<p><strong>参数：</strong> 一般我都是先讲参数再讲示例的，这次倒过来，示例其实很简单，一看就明白。但是这个参数缺需要好好讲下。</p>
<p>这两个参数都跟外键有关。我们修改一下测试用的模型。假设有这样两个模型，一个人员，一个部门，人员属于部门。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-keyword);">class</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">Department</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-function);">Model</span><span style="color:var(--shiki-color-text);">):    </span><span style="color:var(--shiki-token-function);">Name</span><span style="color:var(--shiki-color-text);"> = </span><span style="color:var(--shiki-token-function);">CharField</span><span style="color:var(--shiki-color-text);">()    </span><span style="color:var(--shiki-token-function);">class</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">Meta</span><span style="color:var(--shiki-color-text);">:        </span><span style="color:var(--shiki-token-function);">database</span><span style="color:var(--shiki-color-text);"> = </span><span style="color:var(--shiki-token-function);">dbclass</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">Person</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-function);">Model</span><span style="color:var(--shiki-color-text);">):    </span><span style="color:var(--shiki-token-function);">Name</span><span style="color:var(--shiki-color-text);"> = </span><span style="color:var(--shiki-token-function);">CharField</span><span style="color:var(--shiki-color-text);">()    </span><span style="color:var(--shiki-token-function);">Age</span><span style="color:var(--shiki-color-text);"> = </span><span style="color:var(--shiki-token-function);">IntegerField</span><span style="color:var(--shiki-color-text);">()    </span><span style="color:var(--shiki-token-function);">Birthday</span><span style="color:var(--shiki-color-text);"> = </span><span style="color:var(--shiki-token-function);">DateTimeField</span><span style="color:var(--shiki-color-text);">()    </span><span style="color:var(--shiki-token-function);">Remarks</span><span style="color:var(--shiki-color-text);"> = </span><span style="color:var(--shiki-token-function);">CharField</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-function);">null</span><span style="color:var(--shiki-color-text);">=</span><span style="color:var(--shiki-token-function);">True</span><span style="color:var(--shiki-color-text);">)    </span><span style="color:var(--shiki-token-function);">Department</span><span style="color:var(--shiki-color-text);"> = </span><span style="color:var(--shiki-token-function);">ForeignKeyField</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-function);">Department</span><span style="color:var(--shiki-color-text);">, </span><span style="color:var(--shiki-token-function);">null</span><span style="color:var(--shiki-color-text);">=</span><span style="color:var(--shiki-token-function);">True</span><span style="color:var(--shiki-color-text);">) # </span><span style="color:var(--shiki-token-function);">这里外键可为空和不可为空是不一样的</span><span style="color:var(--shiki-color-text);">，</span><span style="color:var(--shiki-token-function);">下面说明</span><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-function);">class</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">Meta</span><span style="color:var(--shiki-color-text);">:        </span><span style="color:var(--shiki-token-function);">database</span><span style="color:var(--shiki-color-text);"> = </span><span style="color:var(--shiki-token-function);">db</span></span></code></pre></div>
<p>① 当 <code>recursive=False</code> 时，只删除了【部门】，【人员】没有影响，从 SQL 语句中可以看出。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">d </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Department</span><span style="color:var(--shiki-token-function);">.get</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-constant);">d</span><span style="color:var(--shiki-token-function);">.delete_instance</span><span style="color:var(--shiki-color-text);">(recursive</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">False)# 执行的 </span><span style="color:var(--shiki-token-constant);">SQL</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">语句</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'SELECT &quot;t1&quot;.&quot;id&quot;, &quot;t1&quot;.&quot;Name&quot; FROM &quot;department&quot; AS &quot;t1&quot; WHERE ? LIMIT ? OFFSET ?'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">])(</span><span style="color:var(--shiki-token-string-expression);">'DELETE FROM &quot;department&quot; WHERE (&quot;department&quot;.&quot;id&quot; = ?)'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">])</span></span></code></pre></div>
<p>② 当 <code>recursive=True</code> ，并且外键<strong>不可为空</strong>时，会先删除【部门】下的【人员】，再删除【部门】。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">d </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Department</span><span style="color:var(--shiki-token-function);">.get</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-constant);">d</span><span style="color:var(--shiki-token-function);">.delete_instance</span><span style="color:var(--shiki-color-text);">(recursive</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">True)# 执行的 </span><span style="color:var(--shiki-token-constant);">SQL</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">语句</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'SELECT &quot;t1&quot;.&quot;id&quot;, &quot;t1&quot;.&quot;Name&quot; FROM &quot;department&quot; AS &quot;t1&quot; WHERE ? LIMIT ? OFFSET ?'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">])(</span><span style="color:var(--shiki-token-string-expression);">'DELETE FROM &quot;person&quot; WHERE (&quot;person&quot;.&quot;Department_id&quot; = ?)'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">])(</span><span style="color:var(--shiki-token-string-expression);">'DELETE FROM &quot;department&quot; WHERE (&quot;department&quot;.&quot;id&quot; = ?)'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">])</span></span></code></pre></div>
<p>③ 当 <code>recursive=True</code> ，并且外键<strong>可为空</strong>时，先将【人员】的【部门ID（外键字段）】置为了 <em>NULL</em>，再删除【部门】。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">d </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Department</span><span style="color:var(--shiki-token-function);">.get</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-constant);">d</span><span style="color:var(--shiki-token-function);">.delete_instance</span><span style="color:var(--shiki-color-text);">(recursive</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">True)# 执行的 </span><span style="color:var(--shiki-token-constant);">SQL</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">语句</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'SELECT &quot;t1&quot;.&quot;id&quot;, &quot;t1&quot;.&quot;Name&quot; FROM &quot;department&quot; AS &quot;t1&quot; WHERE ? LIMIT ? OFFSET ?'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">])(</span><span style="color:var(--shiki-token-string-expression);">'UPDATE &quot;person&quot; SET &quot;Department_id&quot; = ? WHERE (&quot;person&quot;.&quot;Department_id&quot; = ?)'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [None</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">])(</span><span style="color:var(--shiki-token-string-expression);">'DELETE FROM &quot;department&quot; WHERE (&quot;department&quot;.&quot;id&quot; = ?)'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">])</span></span></code></pre></div>
<p>④ <code>delete_nullable</code> 仅在 <code>recursive=True</code> 且外键<strong>可为空</strong>时有效，和 ③ 一样，当 <code>delete_nullable=True</code> 时，会删除【人员】，而不是将【人员的部门ID】置为 <em>NULL</em>。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">d </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Department</span><span style="color:var(--shiki-token-function);">.get</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-constant);">d</span><span style="color:var(--shiki-token-function);">.delete_instance</span><span style="color:var(--shiki-color-text);">(recursive</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">True</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> delete_nullable</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">True)# 执行的 </span><span style="color:var(--shiki-token-constant);">SQL</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">语句</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'SELECT &quot;t1&quot;.&quot;id&quot;, &quot;t1&quot;.&quot;Name&quot; FROM &quot;department&quot; AS &quot;t1&quot; WHERE ? LIMIT ? OFFSET ?'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">])(</span><span style="color:var(--shiki-token-string-expression);">'DELETE FROM &quot;person&quot; WHERE (&quot;person&quot;.&quot;Department_id&quot; = ?)'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">])(</span><span style="color:var(--shiki-token-string-expression);">'DELETE FROM &quot;department&quot; WHERE (&quot;department&quot;.&quot;id&quot; = ?)'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">])</span></span></code></pre></div>
<h3 id="三修改"><strong>三、修改</strong><a aria-hidden="true" tabindex="-1" href="#三修改" class="internal"> §</a></h3>
<h4 id="1save"><strong>1、save</strong><a aria-hidden="true" tabindex="-1" href="#1save" class="internal"> §</a></h4>
<p>之前说过，<code>save()</code> 方法可以插入一条记录，一旦模型实例具有主键，任何后续调用 <code>save()</code> 都将导致 <em>UPDATE</em> 而不是另一个 <em>INSERT</em>。模型的主键不会改变。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">p </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">Person</span><span style="color:var(--shiki-color-text);">(Name</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">'王五'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Age</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">50</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Birthday</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1970</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">))</span><span style="color:var(--shiki-token-constant);">p</span><span style="color:var(--shiki-token-function);">.save</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-function);">print</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">p1</span><span style="color:var(--shiki-color-text);">.id)</span><span style="color:var(--shiki-token-constant);">p</span><span style="color:var(--shiki-color-text);">.Remarks </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'abc'</span><span style="color:var(--shiki-token-constant);">p</span><span style="color:var(--shiki-token-function);">.save</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<p>这个例子，第一次执行的 <code>save</code> 是 <em>INSERT</em>，第二次是 <em>UPDATE</em>。</p>
<blockquote>
<p>这里解释一下，</p>
</blockquote>
<h4 id="2update"><strong>2、update</strong><a aria-hidden="true" tabindex="-1" href="#2update" class="internal"> §</a></h4>
<p><code>update</code> 用于批量更新，方法相对简单，以下三种写法都可以</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);"># </span><span style="color:var(--shiki-token-constant);">方法一Person</span><span style="color:var(--shiki-token-function);">.update</span><span style="color:var(--shiki-color-text);">({Person.Name</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'赵六'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Person.Remarks</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'abc'</span><span style="color:var(--shiki-color-text);">})</span><span style="color:var(--shiki-token-function);">.where</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Name</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-string-expression);">'王五'</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-function);">.execute</span><span style="color:var(--shiki-color-text);">()# </span><span style="color:var(--shiki-token-constant);">方法二Person</span><span style="color:var(--shiki-token-function);">.update</span><span style="color:var(--shiki-color-text);">({</span><span style="color:var(--shiki-token-string-expression);">'Name'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'赵六'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Remarks'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'abc'</span><span style="color:var(--shiki-color-text);">})</span><span style="color:var(--shiki-token-function);">.where</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Name</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-string-expression);">'张三'</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-function);">.execute</span><span style="color:var(--shiki-color-text);">()# </span><span style="color:var(--shiki-token-constant);">方法三Person</span><span style="color:var(--shiki-token-function);">.update</span><span style="color:var(--shiki-color-text);">(Name</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">'赵六'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> Remarks</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">'abc'</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-function);">.where</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Name</span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-token-string-expression);">'李四'</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-function);">.execute</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<h4 id="3原子更新"><strong>3、原子更新</strong><a aria-hidden="true" tabindex="-1" href="#3原子更新" class="internal"> §</a></h4>
<p>看这样的一个需求，有一张表，记录博客的访问量，每次有人访问博客的时候，访问量+1。</p>
<p>因为懒得新建模型，我们就以 Person 模型的 Age + 1 来演示。</p>
<p>我们可以这样来写：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">for p </span><span style="color:var(--shiki-token-keyword);">in</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.select</span><span style="color:var(--shiki-color-text);">():    </span><span style="color:var(--shiki-token-constant);">p</span><span style="color:var(--shiki-color-text);">.Age </span><span style="color:var(--shiki-token-keyword);">+=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">    </span><span style="color:var(--shiki-token-constant);">p</span><span style="color:var(--shiki-token-function);">.save</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<p>这样当然是可以实现的，但是这不仅速度慢，而且如果多个进程同时更新计数器，它也容易受到竞争条件的影响。</p>
<p>我们可以用 <code>update</code> 方法来实现。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.update</span><span style="color:var(--shiki-color-text);">(Age</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Age</span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)</span><span style="color:var(--shiki-token-function);">.execute</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<h3 id="四查询"><strong>四、查询</strong><a aria-hidden="true" tabindex="-1" href="#四查询" class="internal"> §</a></h3>
<h4 id="1get"><strong>1、get</strong><a aria-hidden="true" tabindex="-1" href="#1get" class="internal"> §</a></h4>
<p><code>Model.get()</code> 方法检索与给定查询匹配的单个实例。 <strong>语法：</strong></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-function);">get</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">query</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-keyword);">**</span><span style="color:var(--shiki-color-text);">filters)</span></span></code></pre></div>
<p><strong>参数：</strong></p>
<ul>
<li>query：查询条件</li>
<li>filters：Mapping of field-name to value for Django-style filter. 我翻遍网上文章和官方文档都没找到这玩意怎么用！</li>
</ul>
<p><strong>示例：</strong></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">p1 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.get</span><span style="color:var(--shiki-color-text);">(Name</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">'张三'</span><span style="color:var(--shiki-color-text);">)</span></span></code></pre></div>
<p>或者</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">p2 </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.get</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Name </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'李四'</span><span style="color:var(--shiki-color-text);">)</span></span></code></pre></div>
<p>当获取的结果不存在时，报 <code>Model.DoesNotExist</code> 异常。如果有多条记录满足条件，则返回第一条。</p>
<h4 id="2get_or_none"><strong>2、get_or_none</strong><a aria-hidden="true" tabindex="-1" href="#2get_or_none" class="internal"> §</a></h4>
<p>如果当获取的结果不存在时，不想报错，可以使用 <code>Model.get_or_none()</code> 方法，会返回 <code>None</code>，参数和 <code>get</code> 方法一致。</p>
<h4 id="3get_by_id"><strong>3、get_by_id</strong><a aria-hidden="true" tabindex="-1" href="#3get_by_id" class="internal"> §</a></h4>
<p>对于主键查找，还可以使用快捷方法<code>Model.get_by_id()</code>。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.get_by_id</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)</span></span></code></pre></div>
<h4 id="4get_or_create"><strong>4、get_or_create</strong><a aria-hidden="true" tabindex="-1" href="#4get_or_create" class="internal"> §</a></h4>
<p><em>Peewee</em> 有一个辅助方法来执行“获取/创建”类型的操作： <code>Model.get_or_create()</code> 首先尝试检索匹配的行。如果失败，将创建一个新行。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">p</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> created </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.get_or_create</span><span style="color:var(--shiki-color-text);">(Name</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-token-string-expression);">'赵六'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> defaults</span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);">{</span><span style="color:var(--shiki-token-string-expression);">'Age'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">80</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'Birthday'</span><span style="color:var(--shiki-token-keyword);">:</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1940</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)})</span><span style="color:var(--shiki-token-function);">print</span><span style="color:var(--shiki-color-text);">(p</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> created)# </span><span style="color:var(--shiki-token-constant);">SQL</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-function);">语句</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'SELECT &quot;t1&quot;.&quot;id&quot;, &quot;t1&quot;.&quot;Name&quot;, &quot;t1&quot;.&quot;Age&quot;, &quot;t1&quot;.&quot;Birthday&quot;, &quot;t1&quot;.&quot;Remarks&quot; FROM &quot;person&quot; AS &quot;t1&quot; WHERE (&quot;t1&quot;.&quot;Name&quot; = ?) LIMIT ? OFFSET ?'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-string-expression);">'赵六'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">0</span><span style="color:var(--shiki-color-text);">])(</span><span style="color:var(--shiki-token-string-expression);">'BEGIN'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> None)(</span><span style="color:var(--shiki-token-string-expression);">'INSERT INTO &quot;person&quot; (&quot;Name&quot;, &quot;Age&quot;, &quot;Birthday&quot;) VALUES (?, ?, ?)'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [</span><span style="color:var(--shiki-token-string-expression);">'赵六'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">80</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">datetime</span><span style="color:var(--shiki-token-function);">.date</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">1940</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">1</span><span style="color:var(--shiki-color-text);">)])</span></span></code></pre></div>
<p><strong>参数：</strong> <code>get_or_create</code> 的参数是 <code>**kwargs</code>，其中 defaults 为非查询条件的参数，剩余的为尝试检索匹配的条件，这个看执行时的 SQL 语句就一目了然了。对于“创建或获取”类型逻辑，通常会依赖唯一 约束或主键来防止创建重复对象。但这并不是强制的，比如例子中，我以 <code>Name</code> 为条件，而 <code>Name</code> 并非主键。只是最好不要这样做。</p>
<p><strong>返回值：</strong> <code>get_or_create</code> 方法有两个返回值，第一个是“获取/创建”的模型实例，第二个是是否新创建。</p>
<h4 id="5select"><strong>5、select</strong><a aria-hidden="true" tabindex="-1" href="#5select" class="internal"> §</a></h4>
<p>使用 <code>Model.select()</code> 查询获取多条数据。<code>select</code> 后可以添加 <code>where</code> 条件，如果不加则查询整个表。</p>
<p><strong>语法：</strong></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-function);">select</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">*</span><span style="color:var(--shiki-color-text);">fields)</span></span></code></pre></div>
<p><strong>参数：</strong></p>
<ul>
<li>fields：需要查询的字段，不传时返回所有字段。传递方式如下例所示。</li>
</ul>
<p><strong>示例：</strong></p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">ps </span><span style="color:var(--shiki-token-keyword);">=</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.select</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Name</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Age)</span><span style="color:var(--shiki-token-function);">.where</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Name </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'张三'</span><span style="color:var(--shiki-color-text);">)</span></span></code></pre></div>
<p><code>select()</code> 返回结果是一个 <code>ModelSelect</code> 对象，该对象可迭代、索引、切片。当查询不到结果时，不报错，返回 <code>None</code>。并且 <code>select()</code> 结果是延时返回的。如果想立即执行，可以调用 <code>execute()</code> 方法。</p>
<blockquote>
<p><strong>注意：</strong><code>where</code> 中的条件不支持 <code>Name='张三'</code> 这种写法，只能是 <code>Person.Name == '张三'</code>。</p>
</blockquote>
<h4 id="6获取记录条数-count-方法"><strong>6、获取记录条数 count 方法</strong><a aria-hidden="true" tabindex="-1" href="#6获取记录条数-count-方法" class="internal"> §</a></h4>
<p>使用 <code>.count()</code> 方法可以获取记录条数。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.select</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-function);">.count</span><span style="color:var(--shiki-color-text);">()</span></span></code></pre></div>
<p>也许你会问，用 <code>len()</code> 方法可以吗？当然也是可以的，但是是一种不可取的方法。</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-function);">len</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.select</span><span style="color:var(--shiki-color-text);">())</span></span></code></pre></div>
<p>这两者的实现方式天差地远。用 <code>count()</code> 方法，执行的 <em>SQL</em> 语句是：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'SELECT COUNT(1) FROM (SELECT 1 FROM &quot;person&quot; AS &quot;t1&quot;) AS &quot;_wrapped&quot;'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [])</span></span></code></pre></div>
<p>而用 <code>len()</code> 方法执行的 <em>SQL</em> 语句却是：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-string-expression);">'SELECT &quot;t1&quot;.&quot;id&quot;, &quot;t1&quot;.&quot;Name&quot;, &quot;t1&quot;.&quot;Age&quot;, &quot;t1&quot;.&quot;Birthday&quot;, &quot;t1&quot;.&quot;Remarks&quot; FROM &quot;person&quot; AS &quot;t1&quot;'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> [])</span></span></code></pre></div>
<p>直接返回所有记录然后获取长度，这种方法是非常不可取的。</p>
<h4 id="7排序-order_by-方法"><strong>7、排序 order_by 方法</strong><a aria-hidden="true" tabindex="-1" href="#7排序-order_by-方法" class="internal"> §</a></h4>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.select</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-function);">.order_by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Age)</span></span></code></pre></div>
<p>排序默认是升序排列，也可以用 <code>+</code> 或 <code>asc()</code> 来明确表示是升序排列：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.select</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-function);">.order_by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">+</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Age)</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.select</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-function);">.order_by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.</span><span style="color:var(--shiki-token-constant);">Age</span><span style="color:var(--shiki-token-function);">.asc</span><span style="color:var(--shiki-color-text);">())</span></span></code></pre></div>
<p>用 <code>-</code> 或 <code>desc()</code> 来表示降序：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.select</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-function);">.order_by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-keyword);">-</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Age)</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.select</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-function);">.order_by</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.</span><span style="color:var(--shiki-token-constant);">Age</span><span style="color:var(--shiki-token-function);">.desc</span><span style="color:var(--shiki-color-text);">())</span></span></code></pre></div>
<p>如要对多个字段进行排序，逗号分隔写就可以了。</p>
<h3 id="五查询条件"><strong>五、查询条件</strong><a aria-hidden="true" tabindex="-1" href="#五查询条件" class="internal"> §</a></h3>
<p>当查询条件不止一个，需要使用逻辑运算符连接，而 Python 中的 <code>and</code>、<code>or</code> 在 Peewee 中是不支持的，此时我们需要使用 Peewee 封装好的运算符，如下：</p>
<p><img src="../../Rsources/Assets/Pasted-image-20221223130833.png" alt/></p>
<blockquote>
<p><strong>特别注意：<strong>有多个条件时，每个条件</strong>必须</strong>用 () 括起来。</p>
</blockquote>
<p>当条件全为 <em>and</em> 时，也可以用逗号分隔，<em>get</em> 和 <em>select</em> 中都可以：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.get</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Name </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'张三'</span><span style="color:var(--shiki-token-punctuation);">,</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Age </span><span style="color:var(--shiki-token-keyword);">==</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-constant);">30</span><span style="color:var(--shiki-color-text);">)</span></span></code></pre></div>
<h3 id="六支持的比较符"><strong>六、支持的比较符</strong><a aria-hidden="true" tabindex="-1" href="#六支持的比较符" class="internal"> §</a></h3>
<p><img src="../../Rsources/Assets/Pasted-image-20221223130845.png" alt/></p>
<blockquote>
<p>注意：由于 SQLite 的 LIKE 操作默认情况下不区分大小写，因此 peewee 将使用 SQLite GLOB 操作进行区分大小写的搜索。glob 操作使用星号表示通配符，而不是通常的百分号。如果您正在使用 SQLite 并希望区分大小写的部分字符串匹配，请记住使用星号作为通配符。</p>
</blockquote>
<p>解释一下，在 SQLite 中，如果希望 like 的时候区分大小写，可以这么写：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.select</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-function);">.where</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Remarks </span><span style="color:var(--shiki-token-keyword);">%</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'a*'</span><span style="color:var(--shiki-color-text);">)</span></span></code></pre></div>
<p>如果不希望区分大小写，这么写：</p>
<div data-rehype-pretty-code-fragment><pre style="background-color:var(--shiki-color-background);" tabindex="0" data-language="javascript" data-theme="default"><code data-language="javascript" data-theme="default"><span data-line><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-token-function);">.select</span><span style="color:var(--shiki-color-text);">()</span><span style="color:var(--shiki-token-function);">.where</span><span style="color:var(--shiki-color-text);">(</span><span style="color:var(--shiki-token-constant);">Person</span><span style="color:var(--shiki-color-text);">.Remarks </span><span style="color:var(--shiki-token-keyword);">**</span><span style="color:var(--shiki-color-text);"> </span><span style="color:var(--shiki-token-string-expression);">'a%'</span><span style="color:var(--shiki-color-text);">)</span></span></code></pre></div></article></div><div class="right sidebar"><div class="graph"><h3>Graph View</h3><div class="graph-outer"><div id="graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:1,&quot;scale&quot;:1.1,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1}"></div><svg version="1.1" id="global-graph-icon" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve"><path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path></svg></div><div id="global-graph-outer"><div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1}"></div></div></div><div class="backlinks"><h3>Backlinks</h3><ul class="overflow"><li>No backlinks found</li></ul></div></div></div><footer><hr/><p>Created with <a href="https://quartz.jzhao.xyz/">Quartz v4.0.7</a>, © 2023</p><ul><li><a href="https://github.com/jackyzha0/quartz">GitHub</a></li><li><a href="https://discord.gg/cRFFHYye7t">Discord Community</a></li></ul></footer></div></body><script type="application/javascript">// quartz/components/scripts/quartz/components/scripts/callout.inline.ts
function toggleCallout() {
  const outerBlock = this.parentElement;
  outerBlock.classList.toggle(`is-collapsed`);
  const collapsed = outerBlock.classList.contains(`is-collapsed`);
  const height = collapsed ? this.scrollHeight : outerBlock.scrollHeight;
  outerBlock.style.maxHeight = height + `px`;
  let current = outerBlock;
  let parent = outerBlock.parentElement;
  while (parent) {
    if (!parent.classList.contains(`callout`)) {
      return;
    }
    const collapsed2 = parent.classList.contains(`is-collapsed`);
    const height2 = collapsed2 ? parent.scrollHeight : parent.scrollHeight + current.scrollHeight;
    parent.style.maxHeight = height2 + `px`;
    current = parent;
    parent = parent.parentElement;
  }
}
function setupCallout() {
  const collapsible = document.getElementsByClassName(
    `callout is-collapsible`
  );
  for (const div of collapsible) {
    const title = div.firstElementChild;
    if (title) {
      title.removeEventListener(`click`, toggleCallout);
      title.addEventListener(`click`, toggleCallout);
      const collapsed = div.classList.contains(`is-collapsed`);
      const height = collapsed ? title.scrollHeight : div.scrollHeight;
      div.style.maxHeight = height + `px`;
    }
  }
}
document.addEventListener(`nav`, setupCallout);
window.addEventListener(`resize`, setupCallout);
</script><script type="module">
          import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.esm.min.mjs';
          const darkMode = document.documentElement.getAttribute('saved-theme') === 'dark'
          mermaid.initialize({ 
            startOnLoad: false,
            securityLevel: 'loose',
            theme: darkMode ? 'dark' : 'default'
          });
          document.addEventListener('nav', async () => {
            await mermaid.run({
              querySelector: '.mermaid'
            })
          });
          </script><script src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/copy-tex.min.js" type="application/javascript"></script><script type="application/javascript">
          const socket = new WebSocket('ws://localhost:3001')
          socket.addEventListener('message', () => document.location.reload())
        </script><script src="../../postscript.js" type="module"></script></html>